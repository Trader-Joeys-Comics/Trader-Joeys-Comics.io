import React, { useState, useEffect } from "react";
import { Link } from "react-router-dom";
import { createPageUrl } from "@/utils";
import { Button } from "@/components/ui/button";
import { Trash2, Plus, Minus, ShoppingCart, ArrowRight, Package } from "lucide-react";
import { toast } from "sonner";

export default function Cart() {
  const [cart, setCart] = useState([]);

  useEffect(() => {
    loadCart();
    
    const handleCartUpdate = () => {
      loadCart();
    };
    
    window.addEventListener('cartUpdated', handleCartUpdate);
    return () => window.removeEventListener('cartUpdated', handleCartUpdate);
  }, []);

  const loadCart = () => {
    const savedCart = JSON.parse(localStorage.getItem('cart') || '[]');
    setCart(savedCart);
  };

  const updateQuantity = (itemId, newQuantity) => {
    if (newQuantity < 1) return;
    
    const updatedCart = cart.map(item => 
      item.id === itemId ? { ...item, quantity: newQuantity } : item
    );
    
    setCart(updatedCart);
    localStorage.setItem('cart', JSON.stringify(updatedCart));
    window.dispatchEvent(new Event('cartUpdated'));
  };

  const removeItem = (itemId) => {
    const updatedCart = cart.filter(item => item.id !== itemId);
    setCart(updatedCart);
    localStorage.setItem('cart', JSON.stringify(updatedCart));
    window.dispatchEvent(new Event('cartUpdated'));
    
    toast.success('Item removed from cart', {
      className: 'comic-text font-bold',
    });
  };

  const getTotal = () => {
    return cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
  };

  return (
    <div className="max-w-6xl mx-auto px-4 py-8">
      <div className="text-center mb-8">
        <div className="inline-block comic-border bg-gradient-to-r from-blue-600 to-purple-600 px-8 py-3 rotate-[-1deg]">
          <h1 className="comic-title text-4xl text-white flex items-center gap-3">
            <ShoppingCart className="w-10 h-10" />
            YOUR CART
          </h1>
        </div>
      </div>

      {cart.length === 0 ? (
        <div className="text-center py-16">
          <div className="inline-block speech-bubble bg-white px-8 py-6 mb-6">
            <Package className="w-16 h-16 mx-auto mb-4 text-gray-400" />
 
